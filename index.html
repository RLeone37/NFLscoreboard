<!doctype html>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Live NFL Scoreboard</title>
<style>
  :root { --bg:#000; --fg:#fff; --muted:#bbb; --card:#111; }
  html,body{margin:0;padding:0;background:var(--bg);color:var(--fg);font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
  .bar{position:sticky;top:0;z-index:10;display:flex;gap:12px;align-items:center;padding:10px 14px;background:#000;border-bottom:1px solid #111}
  .dot{width:10px;height:10px;border-radius:50%;background:#0f0;box-shadow:0 0 8px #0f0}
  .time{margin-left:auto;color:var(--muted);font-size:12px}
  h2{margin:16px 12px 8px;font-size:14px;font-weight:700;color:#ccc;letter-spacing:.06em;text-transform:uppercase}
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(360px,1fr));gap:0}
  .card{position:relative;height:140px;overflow:hidden;background:var(--card)}
  .half{position:absolute;top:0;bottom:0;width:50%}
  .half.left{left:0}.half.right{right:0}
  .half .logo{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;opacity:.95}
  .half .logo img{max-height:80px;max-width:80px}
  .overlay{position:absolute;left:50%;top:0;transform:translateX(-50%);height:100%;width:62%;
           display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;
           background:rgba(0,0,0,.36)}
  .match{font-weight:800;font-size:18px;margin:0}
  .score{font-size:20px;font-weight:800;margin:2px 0 2px}
  .meta{font-size:12px;color:#eee;opacity:.95;margin:0}
  .empty{color:#888;margin:8px 12px}
  .section{margin-bottom:8px}
</style>

<div class="bar">
  <div class="dot"></div><div>Live NFL Scoreboard</div>
  <div class="time" id="time">Loading…</div>
</div>

<div id="root"></div>

<script>
const API = "https://site.api.espn.com/apis/site/v2/sports/football/nfl/scoreboard";
const TEAM_COLORS = {"ARI":"#97233F","ATL":"#A71930","BAL":"#241773","BUF":"#00338D","CAR":"#0085CA","CHI":"#0B162A","CIN":"#FB4F14","CLE":"#311D00","DAL":"#041E42","DEN":"#FB4F14","DET":"#0076B6","GB":"#203731","HOU":"#03202F","IND":"#002C5F","JAX":"#006778","KC":"#E31837","LAC":"#0080C6","LAR":"#003594","LV":"#000000","MIA":"#008E97","MIN":"#4F2683","NE":"#002244","NO":"#D3BC8D","NYG":"#0B2265","NYJ":"#125740","PHI":"#004C54","PIT":"#101820","SF":"#AA0000","SEA":"#002244","TB":"#D50A0A","TEN":"#0C2340","WSH":"#5A1414"};

function contrast(hex){hex=hex.replace('#','');const r=parseInt(hex.slice(0,2),16),g=parseInt(hex.slice(2,4),16),b=parseInt(hex.slice(4,6),16);return (r+g+b)>382?'#000':'#fff'}
function fmtKickoff(iso){try{const d=new Date(iso);return d.toLocaleString([], {weekday:'short', hour:'numeric', minute:'2-digit'});}catch{ return ''; }}
function section(title, inner){return `<div class="section"><h2>${title}</h2>${inner || '<div class="empty">No games in this section.</div>'}</div>`}

// pick the best ESPN logo (prefer 'scoreboard' rel, then 'full', else first)
function pickLogo(logos){
  if(!Array.isArray(logos)) return null;
  const byRel = (rel) => logos.find(l => Array.isArray(l.rel) && l.rel.includes(rel));
  const best = byRel('scoreboard') || byRel('full') || logos[0];
  return best && best.href ? best.href : null;
}

function parseGames(data){
  const games=[];
  for(const ev of (data.events||[])){
    const comp=(ev.competitions||[{}])[0]||{};
    const st=(comp.status||{}).type||{};
    const state=(st.state||"").toLowerCase(); // 'pre' | 'in' | 'post'
    const statustxt = st.shortDetail || st.description || "—";
    const period = (comp.status||{}).period;
    const clock  = (comp.status||{}).displayClock;
    const qclock = period ? ("Q"+period+(clock?(" "+clock):"")) : null;
    const sit    = comp.situation || {};
    const downDist = sit.shortDownDistanceText;
    const poss    = sit.possession;

    // teams
    const t={};
    for(const c of (comp.competitors||[])){
      const info=c.team||{};
      const abbr=info.abbreviation||"";
      const color = info.color ? ("#"+info.color) : (TEAM_COLORS[abbr]||"#333");
      const logo = pickLogo(info.logos);
      const score = (c.score!=null && /^\d+$/.test(String(c.score))) ? Number(c.score) : null;
      t[c.homeAway==="home"?"home":"away"] = { abbr, color, logo, score };
    }

    games.push({
      id: ev.id,
      date: ev.date,
      kickoff: fmtKickoff(ev.date),
      state, // pre/in/post
      statusText: statustxt,
      qclock,
      metaBits: [statustxt, qclock, downDist, (poss?("POSS: "+poss):null)].filter(Boolean),
      home: t.home, away: t.away
    });
  }
  return games;
}

function renderCards(arr){
  return `<div class="grid">` + arr.map(g=>{
    const a=g.away, h=g.home;
    const aC=a.color, hC=h.color, aT=contrast(aC), hT=contrast(hC);
    const as=(a.score==null?'-':a.score), hs=(h.score==null?'-':h.score);
    const aLogo = a.logo ? `<img referrerpolicy="no-referrer" crossorigin="anonymous" src="${a.logo}" alt="${a.abbr} logo">` : `<div style="font-weight:800;font-size:42px">${a.abbr}</div>`;
    const hLogo = h.logo ? `<img referrerpolicy="no-referrer" crossorigin="anonymous" src="${h.logo}" alt="${h.abbr} logo">` : `<div style="font-weight:800;font-size:42px">${h.abbr}</div>`;
    const meta = (g.state==='pre') ? (g.statusText.includes('ET') ? g.statusText : `${g.kickoff} • ${g.statusText}`) : g.metaBits.join(' • ');
    return `
    <div class="card">
      <div class="half left"  style="background:${aC};color:${aT}"><div class="logo">${aLogo}</div></div>
      <div class="half right" style="background:${hC};color:${hT}"><div class="logo">${hLogo}</div></div>
      <div class="overlay">
        <div class="match">${a.abbr} @ ${h.abbr}</div>
        <div class="score">${as} — ${hs}</div>
        <div class="meta">${meta}</div>
      </div>
    </div>`;
  }).join('') + `</div>`;
}

async function load(){
  const timeEl=document.getElementById('time');
  const root=document.getElementById('root');
  try{
    const res = await fetch(API, {cache:"no-store"});
    const json = await res.json();
    const games = parseGames(json);

    const inProg = games.filter(g=>g.state==='in')
                        .sort((a,b)=> (a.qclock? -1:0) - (b.qclock? -1:0));
    const upcoming = games.filter(g=>g.state==='pre')
                          .sort((a,b)=> new Date(a.date)-new Date(b.date));
    const completed = games.filter(g=>g.state==='post')
                           .sort((a,b)=> new Date(b.date)-new Date(a.date));

    const sections = [
      `<div class="section"><h2>In Progress</h2>${inProg.length ? renderCards(inProg) : '<div class="empty">No games in this section.</div>'}</div>`,
      `<div class="section"><h2>Upcoming</h2>${upcoming.length ? renderCards(upcoming) : '<div class="empty">No games in this section.</div>'}</div>`,
      `<div class="section"><h2>Completed</h2>${completed.length ? renderCards(completed) : '<div class="empty">No games in this section.</div>'}</div>`
    ].join('');

    root.innerHTML = sections;
    timeEl.textContent = "Updated " + new Date().toLocaleTimeString();
  }catch(err){
    console.error(err);
    timeEl.textContent = "Update failed";
  }
}

load();
setInterval(load, 30000);
</script>
